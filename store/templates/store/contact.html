{% extends "store/base.html" %}
{% load static %}

{% block title %}Contact Us | MFY{% endblock %}

{% block content %}

<!-- HEADER -->
<section class="relative bg-gradient-to-b from-black via-gray-900 to-black pt-[calc(var(--navbar-height,4.5rem)+2rem)] pb-2 text-center overflow-hidden">
  <h1 class="text-4xl sm:text-5xl font-extrabold text-white drop-shadow-xl animate-pulse">Letâ€™s Talk! âœ¨</h1>
  <p class="text-gray-400 mt-4 text-lg max-w-2xl mx-auto">Weâ€™d love to hear from you â€” reach out anytime ðŸ’¬</p>
</section>

<!-- CONTACT MAIN SECTION -->
<section class="bg-black py-20">
  <div class="max-w-7xl mx-auto px-6 grid lg:grid-cols-3 gap-12">

    <!-- CONTACT INFO -->
    <div class="space-y-8">
      {% for info in infos %}
      <div class="info-card bg-gray-900/60 border border-gray-800 rounded-2xl p-6 shadow-lg transition-all duration-300 hover:shadow-green-600/20 hover:scale-[1.02] opacity-0 translate-y-8">
        <div class="flex items-center space-x-4">
          <span class="text-green-400 bg-green-500/20 p-4 rounded-xl text-2xl">
            <i class="fas {{ info.icon }}"></i>
          </span>
          <div>
            <h4 class="text-white font-semibold">{{ info.title }}</h4>
            <p class="text-gray-400 text-sm">{{ info.desc }}</p>
          </div>
        </div>
      </div>
      {% endfor %}

      <!-- SOCIAL -->
      <div class="flex space-x-5 pt-6 opacity-0 translate-y-8">
        <a href="#" class="text-2xl text-gray-400 hover:text-green-400 transition"><i class="fab fa-instagram"></i></a>
        <a href="#" class="text-2xl text-gray-400 hover:text-green-400 transition"><i class="fab fa-facebook"></i></a>
        <a href="#" class="text-2xl text-gray-400 hover:text-green-400 transition"><i class="fab fa-whatsapp"></i></a>
      </div>
    </div>

  <!-- CONTACT FORM -->
<div class="lg:col-span-2 bg-gray-900/60 border border-gray-800 rounded-2xl p-10 shadow-2xl opacity-0 translate-y-8">
  <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-2">
     Send a Message ðŸ’Œ
  </h2>

  {% if messages %}
    {% for message in messages %}
      <div class="bg-green-600 text-white py-3 px-4 rounded-lg mb-4 animate-fade-in">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <form id="contactForm" method="POST" class="space-y-6 relative">
    {% csrf_token %}

    <!-- NAME + EMAIL -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="relative form-group">
        <i class="fas fa-user form-icon"></i>
        {{ form.name }}
        <label class="floating-label">Your Name</label>
      </div>

      <div class="relative form-group">
        <i class="fas fa-envelope form-icon"></i>
        {{ form.email }}
        <label class="floating-label">Email Address</label>
      </div>
    </div>

    <!-- SUBJECT -->
    <div class="relative form-group">
      <i class="fas fa-tag form-icon"></i>
      {{ form.subject }}
      <label class="floating-label">Subject</label>
    </div>

    <!-- MESSAGE -->
    <div class="relative form-group">
      <i class="fas fa-message form-icon"></i>
      {{ form.message }}
      <label class="floating-label">Message</label>
      <ul id="faq-suggestions" class="hidden absolute z-10 mt-2 bg-gray-900 border border-gray-800 rounded-lg w-full text-sm text-gray-300 shadow-lg"></ul>
    </div>

    <!-- SUBMIT -->
    <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:shadow-[0_0_20px_rgba(34,197,94,0.6)] text-white py-4 rounded-xl font-semibold text-lg transition-all duration-300">
      Send Message ðŸš€
    </button>
  </form>
</div>
  
<!-- MAP --> 
<section class="bg-black pb-20">
  <div class="max-w-7xl mx-auto px-6">
    <div class="rounded-2xl overflow-hidden border border-gray-800 shadow-lg opacity-0 translate-y-8">
      <iframe class="w-full h-[350px] md:h-[450px]" loading="lazy"
        src="https://www.google.com/maps/embed?pb=!1m16!1m12!1m3!1d505498.7850329221!2d77.25200955!3d8.18166325!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!2m1!1sOur%20Lady%20of%20Presentation%20Church!5e0!3m2!1sen!2sin!4v1762416718995!5m2!1sen!2sin" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </div>
</section>

<!-- WHATSAPP BUTTON -->
<a href="https://wa.me/919876543210" target="_blank"
  class="fixed bottom-6 right-6 bg-green-600 hover:bg-green-500 text-white p-4 rounded-full shadow-lg hover:scale-105 transition-all duration-300 z-50">
  <i class="fab fa-whatsapp text-2xl"></i>
</a>

<!-- SUCCESS TOAST -->
<div id="toast"
  class="hidden fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg text-sm font-medium z-50">
  âœ… Message Sent Successfully!
</div>

<!-- STYLE -->
<style>
:root {
  --navbar-height: 4.5rem;
}

.floating-label {
  position: absolute;
  left: 44px;
  top: 14px;
  color: #9CA3AF;
  transition: .25s;
  pointer-events: none;
  background: #101010;
  padding: 0 4px;
}

input, textarea {
  width: 100%;
  background: #101010;
  border: 1px solid #2e2e2e;
  padding: 14px 14px 14px 44px;
  color: white;
  border-radius: 10px;
  outline: none;
  transition: border-color .3s, box-shadow .3s;
}

/* Focus styling */
input:focus, textarea:focus {
  border-color: #22c55e;
  box-shadow: 0 0 10px rgba(34,197,94,0.3);
}

/* Floating label when focus or has value */
input:focus + .floating-label,
textarea:focus + .floating-label,
input.has-value + .floating-label,
textarea.has-value + .floating-label {
  top: -8px;
  left: 38px;
  font-size: 12px;
  color: #22c55e;
}

/* Icons inside input */
.form-icon {
  position: absolute;
  top: 13px;
  left: 14px;
  color: #9CA3AF;
  transition: color .3s;
}

.form-group:focus-within .form-icon {
  color: #22c55e;
}

textarea {
  min-height: 120px;
  resize: none;
}

.animate-fade-in {
  animation: fadeIn .5s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}
</style>

<!-- SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // Reveal animation
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.remove("opacity-0", "translate-y-8");
        entry.target.classList.add("animate-fade-in");
      }
    });
  });
  document.querySelectorAll(".opacity-0").forEach(el => observer.observe(el));

  // Dynamic FAQ suggestions
  const messageInput = document.querySelector("textarea");
  const suggestionBox = document.getElementById("faq-suggestions");
  let timeout = null;
  messageInput.addEventListener("input", () => {
    clearTimeout(timeout);
    const query = messageInput.value.trim();
    if (query.length < 2) {
      suggestionBox.classList.add("hidden");
      return;
    }
    timeout = setTimeout(() => {
      fetch(`/faq/search/?q=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
          suggestionBox.innerHTML = data.results.length
            ? data.results.map(f => `
              <li class='p-2 hover:bg-gray-800 cursor-pointer flex justify-between items-center'>
                <span>${f.question}</span>
                <a href="/faq/?q=${encodeURIComponent(f.slug)}"
                  class="text-green-500 hover:text-green-400 text-xs ml-2 underline">View FAQ</a>
              </li>`).join("")
            : "<li class='p-2 text-gray-500'>No related FAQs</li>";
          suggestionBox.classList.remove("hidden");
        });
    }, 300);
  });

  // Toast
  const form = document.getElementById("contactForm");
  const toast = document.getElementById("toast");
  form.addEventListener("submit", () => {
    toast.classList.remove("hidden");
    setTimeout(() => toast.classList.add("hidden"), 3000);
  });

  // Adjust for navbar height
  const navbar = document.querySelector("nav");
  if (navbar) {
    document.documentElement.style.setProperty("--navbar-height", `${navbar.offsetHeight}px`);
  }
  /* ---------- FLOATING LABEL FIX ---------- */
  document.querySelectorAll("input, textarea").forEach(el => {
    // Ensure placeholder exists
    if (!el.placeholder) el.placeholder = " ";

    // Apply has-value on load (for prefilled forms)
    if (el.value.trim() !== "") {
      el.classList.add("has-value");
    }

    // Live update
    el.addEventListener("input", () => {
      if (el.value.trim() !== "") {
        el.classList.add("has-value");
      } else {
        el.classList.remove("has-value");
      }
    });
  });
});
</script>

{% endblock %}
