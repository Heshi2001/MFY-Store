{% extends "store/base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}
{% if form.instance.pk %}Edit Address{% else %}Add Address{% endif %} â€¢ {{ site_name|default:"MFY Store" }}
{% endblock %}

{% block extra_head %}
<style>
  @keyframes floatUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-floatUp { animation: floatUp 450ms ease-out both; }
  .glass {
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
    backdrop-filter: blur(8px);
  }
  .input-focus {
    box-shadow: 0 0 0 4px rgba(16,185,129,0.25);
    border-color: rgba(16,185,129,0.8) !important;
  }
  .toast { animation: floatUp .4s ease-out; }
</style>
{% endblock %}

{% block content %}
<main class="min-h-screen bg-black text-slate-100 pt-40 pb-24">

  {% if messages %}
  <div class="fixed top-20 right-5 z-[9999] space-y-3">
    {% for message in messages %}
      <div class="toast px-4 py-3 rounded-xl bg-emerald-600 text-black font-semibold shadow-lg flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
             viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M5 13l4 4L19 7"/>
        </svg>
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">

    <div class="mb-10 animate-floatUp">
      <h1 class="text-3xl font-extrabold text-white">
        {% if form.instance.pk %}Edit Address{% else %}Add New Address{% endif %}
      </h1>
      <p class="mt-1 text-sm text-slate-400">Safe and secure addresses to speed up checkout.</p>
    </div>

<section class="rounded-2xl glass border border-slate-800 p-6 shadow-xl animate-floatUp">

  <form method="post" id="address-form">
    {% csrf_token %}

    <!-- ðŸ”¥ Hidden defaults required for valid form -->
    <input type="hidden" name="address_type" value="home">
    <input type="hidden" name="is_default" value="false">
    <input type="hidden" name="country" value="India">

    <!-- NAME -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

      <div>
        <label class="block text-sm text-slate-300 mb-1">First name</label>
        <div class="relative">
          <span class="absolute left-3 top-2.5 text-slate-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M5.121 17.804A4 4 0 0112 15a4 4 0 016.879 2.804M12 9a4 4 0 110-8 4 4 0 010 8z"/>
            </svg>
          </span>
          {{ form.first_name|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
        </div>
      </div>

      <div>
        <label class="block text-sm text-slate-300 mb-1">Last name</label>
        <div class="relative">
          <span class="absolute left-3 top-2.5 text-slate-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M5.121 17.804A4 4 0 0112 15a4 4 0 016.879 2.804M12 9a4 4 0 110-8 4 4 0 010 8z"/>
            </svg>
          </span>
          {{ form.last_name|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
        </div>
      </div>

    </div>

    <!-- PHONE -->
    <div class="mt-4">
      <label class="block text-sm text-slate-300 mb-1">Phone</label>
      <div class="relative">
        <span class="absolute left-3 top-2.5 text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
               fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 5a2 2 0 012-2h2l2 6-2 1c1 4 4 7 8 8l1-2 6 2v2a2 2 0 01-2 2h-1C9 21 3 15 3 7V5z"/>
          </svg>
        </span>
        {{ form.phone|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
      </div>
    </div>

    <!-- ADDRESS1 -->
    <div class="mt-4">
      <label class="block text-sm text-slate-300 mb-1">Address line 1</label>
      <div class="relative">
        <span class="absolute left-3 top-2.5 text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 10.5l9-7.5 9 7.5v9a1.5 1.5 0 01-1.5 1.5h-15A1.5 1.5 0 013 19.5v-9z"/>
          </svg>
        </span>
        {{ form.address_line1|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
      </div>
    </div>

    <!-- ADDRESS2 -->
    <div class="mt-4">
      <label class="block text-sm text-slate-300 mb-1">Address line 2 (optional)</label>
      <div class="relative">
        <span class="absolute left-3 top-2.5 text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 10.5l9-7.5 9 7.5v9a1.5 1.5 0 01-1.5 1.5h-15A1.5 1.5 0 013 19.5v-9z"/>
          </svg>
        </span>
        {{ form.address_line2|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
      </div>
    </div>

    <!-- CITY / STATE / PIN -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">

      <div>
        <label class="block text-sm text-slate-300 mb-1">City</label>
        <div class="relative">
          <span class="absolute left-3 top-2.5 text-slate-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 21h18M4.5 21V9l7.5-3 7.5 3v12"/>
            </svg>
          </span>
          {{ form.city|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
        </div>
      </div>

      <div>
        <label class="block text-sm text-slate-300 mb-1">State</label>
        <div class="relative">
          <span class="absolute left-3 top-2.5 text-slate-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 11.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5zM12 21s7.5-4.5 7.5-10.5A7.5 7.5 0 004.5 10.5C4.5 16.5 12 21 12 21z"/>
            </svg>
          </span>
          {{ form.state|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
        </div>
      </div>

      <div>
        <label class="block text-sm text-slate-300 mb-1">Postal code</label>
        <div class="relative">
          <span class="absolute left-3 top-2.5 text-slate-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M5 9h14M5 15h14M9 3L7 21M17 3l-2 18"/>
            </svg>
          </span>
          {{ form.postal_code|add_class:"w-full bg-transparent border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm text-slate-100 focus:outline-none" }}
        </div>
      </div>

    </div>

    <!-- BUTTONS -->
    <div class="mt-8 flex flex-col sm:flex-row gap-3">

      <button type="submit"
        class="w-full sm:w-auto inline-flex items-center gap-2 justify-center rounded-full bg-emerald-600 hover:bg-emerald-500 px-6 py-3 text-sm font-semibold text-black shadow-xl transition-transform hover:scale-[1.02]">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
             viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 4v16m8-8H4"/>
        </svg>
        Save Address
      </button>

      <a href="{% url 'account_addresses' %}"
         class="w-full sm:w-auto inline-flex items-center justify-center rounded-full border border-slate-700 px-6 py-3 text-sm text-slate-200 hover:bg-slate-800">
        Cancel
      </a>

    </div>

  </form>

</section>

  </div>
</main>
{% endblock %}

{% block extra_scripts %}
<script>
document.querySelectorAll('input, select, textarea').forEach(el => {
  el.addEventListener('focus', () => el.classList.add('input-focus'));
  el.addEventListener('blur', () => el.classList.remove('input-focus'));
});

setTimeout(() => {
  document.querySelectorAll('.toast').forEach(t => t.style.opacity = 0);
}, 3000);
</script>
{% endblock %}
