{% load i18n %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% trans "Change Password" %} | MFY Store</title>
  <meta name="description" content="Change your MFY Store account password securely.">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            neon: '#00ff9c',
            darkbg: '#0b0f14',
            darkcard: '#111827',
            textmuted: '#a1a1aa'
          },
          boxShadow: {
            neon: '0 0 24px rgba(0,255,156,0.35)'
          }
        }
      }
    }
  </script>

  <!-- INLINE CSS -->
  <style>
    .password-toggle {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #9ca3af;
    }

    .password-toggle.active {
      color: #00ff9c;
    }

    .eye {
      width: 20px;
      height: 20px;
      display: inline-block;
      background: currentColor;
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath stroke='white' stroke-width='2' fill='none' d='M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12Z'/%3E%3Ccircle cx='12' cy='12' r='3' stroke='white' stroke-width='2' fill='none'/%3E%3C/svg%3E") center / contain no-repeat;
    }

    .password-meter {
      height: 4px;
      background: #1f2937;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 6px;
    }

    .meter-bar {
      height: 100%;
      width: 0%;
      transition: width 0.3s ease, background 0.3s ease;
    }

    .meter-weak { background: #ef4444; }
    .meter-medium { background: #facc15; }
    .meter-strong { background: #22c55e; }
  </style>
</head>

<body class="min-h-screen bg-darkbg flex items-center justify-center px-4">

  <!-- Neon background glow -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute -top-40 -left-40 w-96 h-96 bg-neon/10 blur-3xl rounded-full"></div>
    <div class="absolute bottom-0 right-0 w-96 h-96 bg-neon/5 blur-3xl rounded-full"></div>
  </div>

  <div class="relative w-full max-w-md bg-darkcard border border-white/10 rounded-2xl shadow-xl p-8 md:p-10">

    <!-- Header -->
    <div class="text-center mb-6">
      <div class="mx-auto mb-3 flex h-16 w-16 items-center justify-center rounded-full bg-neon/10 text-neon text-3xl shadow-neon">
        üîí
      </div>
      <h1 class="text-2xl font-bold text-white">{% trans "Change Password" %}</h1>
      <p class="text-textmuted mt-1">Keep your MFY Store account secure</p>
    </div>

    {% if form.non_field_errors %}
      <div class="bg-red-500/10 border border-red-500/30 text-red-400 p-3 rounded mb-4 text-sm">
        {% for error in form.non_field_errors %}
          <div>{{ error }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="POST" action="{% url 'account_change_password' %}" class="space-y-5">
      {% csrf_token %}

      <!-- Current Password -->
      <div class="relative">
        <label class="block text-sm text-gray-300 mb-1">{% trans "Current Password" %}</label>
        {% render_field form.oldpassword class="w-full bg-darkbg text-white border border-white/20 rounded-lg px-3 py-2 pr-12 focus:ring-2 focus:ring-neon" %}
        <button type="button" class="password-toggle" data-target="{{ form.oldpassword.id_for_label }}">
          <span class="eye"></span>
        </button>
      </div>

      <!-- New Password -->
      <div class="relative">
        <label class="block text-sm text-gray-300 mb-1">{% trans "New Password" %}</label>
        {% render_field form.password1 class="w-full bg-darkbg text-white border border-white/20 rounded-lg px-3 py-2 pr-12 focus:ring-2 focus:ring-neon" %}
        <button type="button" class="password-toggle" data-target="{{ form.password1.id_for_label }}">
          <span class="eye"></span>
        </button>

        <div class="password-meter">
          <div class="meter-bar"></div>
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="relative">
        <label class="block text-sm text-gray-300 mb-1">{% trans "Confirm New Password" %}</label>
        {% render_field form.password2 class="w-full bg-darkbg text-white border border-white/20 rounded-lg px-3 py-2 pr-12 focus:ring-2 focus:ring-neon" %}
        <button type="button" class="password-toggle" data-target="{{ form.password2.id_for_label }}">
          <span class="eye"></span>
        </button>
        <p class="password-match text-sm mt-1 hidden"></p>
      </div>

      <button type="submit" class="w-full bg-neon text-black font-semibold py-3 rounded-lg hover:bg-white hover:shadow-neon transition">
        {% trans "Update Password" %}
      </button>
    </form>

    <div class="mt-4 text-center">
      <a href="{% url 'account_dashboard' %}" class="text-neon hover:underline inline-flex items-center gap-1">
        ‚Üê {% trans "Back to Dashboard" %}
      </a>
    </div>

  </div>

<!-- INLINE JS -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  // Eye toggle (click + hold)
  document.querySelectorAll(".password-toggle").forEach(btn => {
    const input = document.getElementById(btn.dataset.target);
    if (!input) return;

    const show = () => { input.type = "text"; btn.classList.add("active"); };
    const hide = () => { input.type = "password"; btn.classList.remove("active"); };

    btn.addEventListener("click", () => input.type === "password" ? show() : hide());
    btn.addEventListener("touchstart", show);
    btn.addEventListener("touchend", hide);
    btn.addEventListener("mouseleave", hide);
  });

  // Strength meter
  const password1 = document.getElementById("id_password1");
  const meter = document.querySelector(".meter-bar");

  if (password1 && meter) {
    password1.addEventListener("input", () => {
      let score = 0;
      const v = password1.value;
      if (v.length >= 8) score++;
      if (/[A-Z]/.test(v)) score++;
      if (/[0-9]/.test(v)) score++;
      if (/[^A-Za-z0-9]/.test(v)) score++;

      meter.className = "meter-bar";
      if (score <= 1) { meter.style.width = "25%"; meter.classList.add("meter-weak"); }
      else if (score <= 3) { meter.style.width = "60%"; meter.classList.add("meter-medium"); }
      else { meter.style.width = "100%"; meter.classList.add("meter-strong"); }
    });
  }

  // Password match check
  const password2 = document.getElementById("id_password2");
  const matchMsg = document.querySelector(".password-match");

  if (password1 && password2 && matchMsg) {
    password2.addEventListener("input", () => {
      matchMsg.classList.remove("hidden");
      if (!password2.value) {
        matchMsg.classList.add("hidden");
      } else if (password1.value === password2.value) {
        matchMsg.textContent = "‚úì Passwords match";
        matchMsg.className = "password-match text-green-400";
      } else {
        matchMsg.textContent = "‚úó Passwords do not match";
        matchMsg.className = "password-match text-red-400";
      }
    });
  }
});
</script>

</body>
</html>
