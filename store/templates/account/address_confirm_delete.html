{% extends "store/base.html" %}
{% load static %}

{% block title %}Delete Address | MFY Store{% endblock %}
{% block meta_description %}Delete saved address from MFY Store with confirmation popup and secure validation.{% endblock %}

{% block content %}
<section class="min-h-screen bg-black pt-[10rem] pb-20 flex items-center justify-center px-6">

  <!-- BACKDROP -->
  <div id="delete-backdrop"
       class="fixed inset-0 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-all duration-300">
  </div>

  <!-- POPUP -->
  <div id="delete-popup"
     class="fixed top-[-100%] left-1/2 -translate-x-1/2 
            w-[92%] max-w-sm               
            md:w-full md:max-w-md          
            scale-90 md:scale-100          
            rounded-3xl border border-white/10 
            bg-white/10 backdrop-blur-xl shadow-2xl
            pt-2 pb-4 px-4                  
            md:pt-3 md:pb-5 md:px-5         
            text-center transition-all duration-500">

    {% if address.is_default %}

      <div class="w-20 h-20 mx-auto mb-4 flex items-center justify-center
           rounded-full bg-yellow-500/10 border border-yellow-500/30">
        <i class="fa-solid fa-lock text-yellow-400 text-4xl"></i>
      </div>

      <h1 class="text-xl font-bold text-white mb-2">Default Address</h1>
      <p class="text-gray-300 mb-6">
        This is your default address and cannot be deleted.
      </p>

      <a href="{% url 'account_addresses' %}"
         class="w-full block py-2.5 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-gray-200 
                font-medium tracking-wide transition-all">
        Close
      </a>

    {% else %}

      <!-- Lottie Animation -->
      <div id="warning-lottie" class="w-16 h-16 mx-auto mb-3"></div>

      <h1 class="text-xl font-bold text-white mb-2 tracking-wide">Delete Address</h1>

      <p class="text-gray-300 mb-5 leading-relaxed">
        Are you sure you want to remove this address?
        Once deleted, it cannot be recovered.
      </p>

      <!-- Address Card -->
      <div class="bg-black/20 border border-zinc-700 rounded-xl p-3 mb-6 text-left">
        <h2 class="font-semibold text-white text-base mb-1">
          {{ address.first_name }} {{ address.last_name }}
        </h2>
        <p class="text-gray-400 text-sm leading-relaxed">
          {{ address.address_line1 }}
          {% if address.address_line2 %}, {{ address.address_line2 }}{% endif %}<br>
          {{ address.city }}, {{ address.state }} - {{ address.postal_code }}
        </p>
      </div>

      <!-- Delete Button -->
      <button id="confirmDelete"
              data-url="{% url 'delete_address' address.id %}"
              class="w-full py-2.5 mb-2 rounded-xl bg-red-600 hover:bg-red-700 text-white font-semibold
                     tracking-wide transform hover:scale-[1.02] active:scale-95 transition-all">
        Yes, Delete Address
      </button>

      <!-- Cancel -->
      <a href="{% url 'account_addresses' %}"
         class="w-full block py-2.5 rounded-xl bg-zinc-900 hover:bg-zinc-800 
                text-gray-200 font-medium tracking-wide transition-all">
        Cancel
      </a>

    {% endif %}
  </div>

  <!-- SUCCESS TOAST -->
  <div id="delete-toast"
       class="fixed top-6 right-6 bg-green-600 text-white px-6 py-3 rounded-xl shadow-xl opacity-0 
              translate-y-[-20px] transition-all duration-300">
    Address deleted successfully.
  </div>

</section>

<!-- Lottie JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const popup = document.getElementById("delete-popup");
    const backdrop = document.getElementById("delete-backdrop");

    // Popup slides down â€” more gap from navbar
    setTimeout(() => {
        popup.style.top = "10rem";    // <-- Adjusted spacing here
        popup.style.transform = "translate(-50%, 0)";
        backdrop.style.opacity = "1";
        backdrop.style.pointerEvents = "auto";
    }, 50);

    // Lottie
    if (document.getElementById("warning-lottie")) {
        lottie.loadAnimation({
            container: document.getElementById("warning-lottie"),
            renderer: "svg",
            loop: true,
            autoplay: true,
            path: "{% static 'store/lottie/warning.json' %}"
        });
    }

    // Delete AJAX
    const delBtn = document.getElementById("confirmDelete");
    if (delBtn) {
        delBtn.addEventListener("click", async function () {
            const response = await fetch(this.dataset.url, {
                method: "POST",
                headers: { "X-CSRFToken": "{{ csrf_token }}" },
            });

            if (response.ok) {
                const toast = document.getElementById("delete-toast");
                toast.style.opacity = "1";
                toast.style.transform = "translateY(0)";

                setTimeout(() => {
                    window.location.href = "{% url 'account_addresses' %}";
                }, 1000);
            }
        });
    }
});
</script>

{% endblock %}
